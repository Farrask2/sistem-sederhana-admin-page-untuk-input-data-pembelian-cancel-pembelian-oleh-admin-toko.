<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Riwayat Transaksi - Laptop Store</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<div class="container dashboard-container">
    <div class="header-section d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-primary mb-0"><i class="fa-solid fa-clock-rotate-left me-2"></i>Riwayat Transaksi</h2>
            <p class="text-muted">Kelola dan pantau seluruh penjualan laptop</p>
        </div>
        <a href="/" class="btn btn-outline-primary shadow-sm">
            <i class="fa-solid fa-plus me-2"></i>Input Baru
        </a>
    </div>

    <div class="glass-card mb-4 py-3 px-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text bg-transparent border-end-0">
                        <i class="fa-solid fa-magnifying-glass text-muted"></i>
                    </span>
                    <input type="text" id="searchInput" class="form-control border-start-0 ps-0 shadow-none" placeholder="Cari nama laptop atau ID pesanan...">
                </div>
            </div>
            <div class="col-md-4 text-end">
                <small class="text-muted me-2">Total: <strong><%= pembelian.length %></strong> transaksi</small>
            </div>
        </div>
    </div>

    <div class="table-container shadow-sm">
        <div class="table-responsive">
            <table class="table" id="transactionTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Model Laptop</th>
                        <th>Qty</th>
                        <th>Total Bayar</th>
                        <th>Status</th>
                        <th class="text-center">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (pembelian.length === 0) { %>
                        <tr><td colspan="6" class="text-center py-5 text-muted">Belum ada data transaksi.</td></tr>
                    <% } %>
                    <% pembelian.forEach(p => { %>
                        <tr class="transaction-row">
                            <td class="text-muted small">#<%= p.id %></td>
                            <td><span class="fw-bold laptop-name"><%= p.nama_produk %></span></td>
                            <td><span class="badge bg-light text-dark px-3"><%= p.jumlah %></span></td>
                            <td class="fw-bold text-primary">Rp<%= p.total_harga.toLocaleString('id-ID') %></td>
                            <td>
                                <% if(p.status === 'BERHASIL') { %>
                                    <span class="badge-custom bg-success-soft">Selesai</span>
                                <% } else { %>
                                    <span class="badge-custom bg-danger-soft text-danger">Dibatalkan</span>
                                <% } %>
                            </td>
                            <td class="text-center">
                                <% if(p.status === 'BERHASIL') { %>
                                    <form action="/cancel/<%= p.id %>" method="POST" onsubmit="return confirm('Apakah Anda yakin ingin membatalkan transaksi ini? Stok akan dikembalikan.')">
                                        <button class="btn btn-link text-danger p-0 text-decoration-none fw-bold small">
                                            <i class="fa-solid fa-xmark me-1"></i>Batal
                                        </button>
                                    </form>
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.getElementById('searchInput').addEventListener('keyup', function() {
        const filter = this.value.toLowerCase();
        const rows = document.querySelectorAll('.transaction-row');

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    });
</script>

</body>
</html>